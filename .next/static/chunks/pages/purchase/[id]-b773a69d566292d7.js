(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[612],{3248:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/purchase/[id]",function(){return r(5011)}])},9270:function(t,e,r){"use strict";r.d(e,{Z:function(){return a}});var n=r(5893);function a(){return(0,n.jsx)("div",{className:"loader"})}},4689:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var n=r(5893),a=r(4849);function o(t){for(var e=t.td,r=t.tr,o=[],s=0;s<r;s++)o.push(s);for(var c=[],i=0;i<e;i++)c.push(i);return o.map((function(t,e){return(0,n.jsx)("tr",{children:c.map((function(t,e){return(0,n.jsx)("td",{children:(0,n.jsx)(a.y,{baseColor:"rgba(249, 58, 11, 0.1)",highlightColor:"#212130",children:(0,n.jsx)("p",{children:(0,n.jsx)(a.Z,{width:"100%",height:30})})})},e)}))},e)}))}},5011:function(t,e,r){"use strict";r.r(e),r.d(e,{__N_SSP:function(){return k},default:function(){return S}});var n=r(4051),a=r.n(n),o=r(5893),s=r(9629),c=r(9008),i=r(5538),u=r(9669),l=r.n(u),d=r(9755),h=r.n(d),p=r(7294),m=r(9198),f=r.n(m),x=r(9270),j=r(4849),b=r(4689);function v(t,e,r,n,a,o,s){try{var c=t[o](s),i=c.value}catch(u){return void r(u)}c.done?e(i):Promise.resolve(i).then(n,a)}function g(t){var e=t.name,r=t.id,n=t.token,s={headers:{Authorization:"Bearer ".concat(n)}},c=(0,p.useState)(null),i=c[0],u=c[1],d=(0,p.useState)(),m=d[0],f=d[1],x=function(){var t,e=(t=a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:h()(".autocompleteItemContainer.supplier").show(),i&&(clearTimeout(i),u(null)),e=h()(".autocompleteInput").val(),u(setTimeout((function(){l().get("".concat("http://pos-backend.webxcode.xyz/api","/supplier?name=").concat(e),s).then((function(t){!0===t.data.status&&f(t.data.suppliers.data)})).catch((function(t){console.log(t)}))}),1e3));case 4:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function s(t){v(o,n,a,s,c,"next",t)}function c(t){v(o,n,a,s,c,"throw",t)}s(void 0)}))});return function(){return e.apply(this,arguments)}}();return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"autocompleteWrapper",children:[(0,o.jsx)("input",{type:"text",className:"form-control autocompleteInput supplier-input",autoComplete:"off",defaultValue:e,onKeyUp:x,onKeyDown:x,onChange:x}),(0,o.jsx)("input",{type:"hidden",className:"supplier-id",defaultValue:r}),(0,o.jsx)("div",{className:"autocompleteItemContainer supplier",children:m&&m.map((function(t){return(0,o.jsx)("div",{className:"autocompleteItem",onClick:function(){return e=t.name,r=t.id,h()(".supplier-input").val(e),h()(".supplier-id").val(r),void h()(".autocompleteItemContainer.supplier").hide();var e,r},children:t.name},"supplier-".concat(t.id))}))})]})})}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function N(t,e,r,n,a,o,s){try{var c=t[o](s),i=c.value}catch(u){return void r(u)}c.done?e(i):Promise.resolve(i).then(n,a)}function w(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function s(t){N(o,n,a,s,c,"next",t)}function c(t){N(o,n,a,s,c,"throw",t)}s(void 0)}))}}function C(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var k=!0;function S(t){var e=t.user,r=t.id,n=(0,p.useState)(!1),u=n[0],d=n[1],m=(0,p.useState)(0),v=m[0],y=m[1],N=(0,p.useState)(0),k=N[0],S=N[1],P=(0,p.useState)(),_=P[0],A=P[1],I=(0,p.useState)(!0),D=I[0],F=I[1],O=(0,p.useState)(),Z=O[0],T=O[1],K=(0,p.useState)(null),E=K[0],B=K[1],U=(0,p.useState)(new Date),V=U[0],z=U[1],Q=(0,p.useState)([]),H=Q[0],M=Q[1],q={headers:{Authorization:"Bearer ".concat(e.token)}};(0,p.useEffect)((function(){l().get("".concat("http://pos-backend.webxcode.xyz/api","/purchase/").concat(r),q).then((function(t){!0===t.data.status&&(A(t.data.purchase),y(t.data.purchase.purchaseData.amount),z(new Date(t.data.purchase.purchaseData.date)),S(t.data.purchase.purchaseData.paid),M(t.data.purchase.purchaseItems),F(!1))})).catch((function(t){console.log(t)}))}),[A,y,z,S,M,F]);var W=function(){var t=w(a().mark((function t(e){var n,o,s,c,u,p,m,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),i.Am.loading("Submitting",{position:"bottom-right",theme:"dark"}),d(!0),n=h()(".productId").map((function(t,e){return h()(e).val()})).get(),o=h()(".productQuantity").map((function(t,e){return h()(e).val()})).get(),s=h()(".productPrice").map((function(t,e){return h()(e).val()})).get(),c=h()(".note").val(),u=h()(".date").val(),p=h()(".paid").val(),""!==(m=h()(".supplier-id").val())){t.next=15;break}return d(!1),i.Am.dismiss(),i.Am.error("Please select supplier",{position:"bottom-right",autoClose:!1,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"dark"}),t.abrupt("return");case 15:if(!(n.length<=0)){t.next=20;break}return d(!1),i.Am.dismiss(),i.Am.error("No product added",{position:"bottom-right",autoClose:!1,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"dark"}),t.abrupt("return");case 20:return t.prev=20,t.next=23,l().post("".concat("http://pos-backend.webxcode.xyz/api","/purchase/update"),{purchase_id:r,supplier_id:m,productIds:n,productQuantities:o,productPrices:s,date:u,comment:c,paid:p,total:v},q);case 23:!0===(f=t.sent).data.status?(i.Am.dismiss(),i.Am.success("Successfully Saved",{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"dark"}),d(!1)):(i.Am.dismiss(),i.Am.success(f.data.error,{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"dark"}),d(!1)),t.next=32;break;case 27:t.prev=27,t.t0=t.catch(20),i.Am.dismiss(),i.Am.error(t.t0.response.data,{position:"bottom-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"dark"}),d(!1);case 32:case"end":return t.stop()}}),t,null,[[20,27]])})));return function(e){return t.apply(this,arguments)}}(),X=function(t){var e=parseFloat(h()(".productPrice_".concat(t)).val())*parseFloat(h()(".productQuantity_".concat(t)).val());h()(".subtotal_".concat(t)).text("".concat(e)),L()},L=function(){y(0),h()(".subtotal").each((function(){var t=this;y((function(e){return e+parseFloat(h()(t).text())}))}))},$=function(){var t=h()(".paid").val();S(""!==t?parseFloat(t):0)},G=function(){var t=w(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:h()(".autocompleteItemContainer.product").show(),E&&(clearTimeout(E),B(null)),e=h()(".search-product").val(),B(setTimeout((function(){l().get("".concat("http://pos-backend.webxcode.xyz/api","/product?name=").concat(e),q).then((function(t){!0===t.data.status&&T(t.data.products.data)})).catch((function(t){console.log(t)}))}),500));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.default,{children:(0,o.jsx)("title",{children:"Edit Purchase"})}),u&&!0===u&&(0,o.jsx)(x.Z,{}),(0,o.jsx)(i.Ix,{}),(0,o.jsx)(s.Z,{user:e,title:"Edit Purchase",children:(0,o.jsx)("div",{className:"content",children:(0,o.jsx)("div",{className:"custom-card",children:(0,o.jsxs)("form",{onSubmit:W,children:[(0,o.jsx)("div",{className:"mb-3",children:(0,o.jsxs)("div",{className:"row",children:[(0,o.jsxs)("div",{className:"col-md-6",children:[(0,o.jsx)("label",{htmlFor:"supplier",className:"form-label",children:"Supplier"}),_&&!1===D&&(0,o.jsx)(g,{name:_.purchaseData.supplier_name,id:_.purchaseData.supplier_id,token:e.token})||(0,o.jsx)(j.y,{baseColor:"rgba(249, 58, 11, 0.1)",highlightColor:"#212130",children:(0,o.jsx)(j.Z,{width:"100%",height:40})})]}),(0,o.jsxs)("div",{className:"col-md-6",children:[(0,o.jsx)("label",{htmlFor:"date",className:"form-label",children:"Date"}),_&&!1===D&&(0,o.jsx)(f(),{selected:V,onChange:function(t){return z(t)},dateFormat:"yyyy-MM-dd",className:"form-control date"})||(0,o.jsx)(j.y,{baseColor:"rgba(249, 58, 11, 0.1)",highlightColor:"#212130",children:(0,o.jsx)(j.Z,{width:"100%",height:40})})]})]})}),(0,o.jsxs)("div",{className:"mb-3",children:[(0,o.jsx)("label",{htmlFor:"product",className:"form-label",children:"Choose Product"}),(0,o.jsxs)("div",{className:"autocompleteWrapper product",children:[(0,o.jsx)("input",{type:"text",className:"form-control autocompleteInput search-product",autoComplete:"off",onKeyUp:G,onKeyDown:G,onChange:G,placeholder:"Search product"}),(0,o.jsx)("div",{className:"autocompleteItemContainer product",children:Z&&Z.map((function(t){return(0,o.jsx)("div",{className:"autocompleteItem",onClick:function(){return function(t){var e=H.filter((function(e){return e.id===t.id.toString()}));console.log(e),e.length>0?alert("Product already added"):(M((function(e){return C(e).concat([t])})),y((function(e){return parseFloat(e)+parseFloat(t.price)}))),h()(".autocompleteItemContainer.product").hide(),h()(".search-product").val("")}(t)},children:t.name},"search-product-item-".concat(t.id))}))})]})]}),(0,o.jsxs)("table",{className:"table table-bordered table-hover",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{width:"5%",children:"SL"}),(0,o.jsx)("th",{width:"40%",children:"Product Name"}),(0,o.jsx)("th",{width:"15%",children:"Purchase Price"}),(0,o.jsx)("th",{width:"15%",children:"Quantity"}),(0,o.jsx)("th",{className:"text-end",width:"20%",children:"Subtotal"}),(0,o.jsx)("th",{className:"text-center",width:"5%",children:"Action"})]})}),(0,o.jsx)("tbody",{children:H&&!D&&H.map((function(t,e){return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:e+1}),(0,o.jsxs)("td",{children:[t.name,(0,o.jsx)("input",{type:"hidden",className:"productId",defaultValue:t.id})]}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"text",className:"form-control productPrice productPrice_".concat(t.id),defaultValue:t.price,onChange:function(){return X(t.id)},onKeyUp:function(){return X(t.id)},onKeyDown:function(){return X(t.id)}})}),(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"text",className:"form-control productQuantity productQuantity_".concat(t.id),defaultValue:t.quantity?t.quantity:1,onChange:function(){return X(t.id)},onKeyUp:function(){return X(t.id)},onKeyDown:function(){return X(t.id)}})}),(0,o.jsxs)("td",{className:"text-end",children:[(0,o.jsx)("span",{className:"subtotal subtotal_".concat(t.id),children:t.total?t.total:t.price})," Tk."]}),(0,o.jsx)("td",{className:"text-center",children:(0,o.jsx)("button",{className:"btn btn-danger btn-sm",onClick:function(){return function(t){var e=H.filter((function(e){return e.id!==t}));M(e),y(0),e.map((function(t){y((function(e){return e+parseFloat(h()(".subtotal_".concat(t.id)).text())}))}))}(t.id)},children:(0,o.jsx)("i",{className:"fa-solid fa-trash-can"})})})]},"purchase-product-item-".concat(t.id))}))||(0,o.jsx)(b.Z,{tr:5,td:6})}),(0,o.jsxs)("tfoot",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{className:"text-end",colSpan:4,children:(0,o.jsx)("strong",{children:"Total"})}),(0,o.jsx)("td",{className:"text-end border-1 border-white d-block",children:_&&!1===D&&(0,o.jsxs)("span",{className:"total",children:[v," Tk."]})||(0,o.jsx)(j.y,{baseColor:"rgba(249, 58, 11, 0.1)",highlightColor:"#212130",children:(0,o.jsx)(j.Z,{width:"100%",height:30})})}),(0,o.jsx)("td",{})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{className:"text-end",colSpan:4,children:(0,o.jsx)("strong",{children:"Paid"})}),(0,o.jsx)("td",{className:"px-0",children:_&&!1===D&&(0,o.jsx)("input",{type:"text",className:"form-control paid",onKeyUp:$,onKeyDown:$,onChange:$,defaultValue:_.purchaseData.paid})||(0,o.jsx)(j.y,{baseColor:"rgba(249, 58, 11, 0.1)",highlightColor:"#212130",children:(0,o.jsx)(j.Z,{width:"100%",height:30})})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{className:"text-end",colSpan:4,children:(0,o.jsx)("strong",{children:"Due"})}),(0,o.jsx)("td",{className:"text-end border-1 border-white d-block",children:_&&!1===D&&(0,o.jsxs)("span",{className:"due",children:[v-k," Tk."]})||(0,o.jsx)(j.y,{baseColor:"rgba(249, 58, 11, 0.1)",highlightColor:"#212130",children:(0,o.jsx)(j.Z,{width:"100%",height:30})})})]})]})]}),(0,o.jsxs)("div",{className:"mb-3 mt-3",children:[(0,o.jsx)("label",{htmlFor:"note",className:"form-label",children:"Note"}),_&&!D&&(0,o.jsx)("textarea",{id:"note",rows:"3",className:"note form-control",defaultValue:_.purchaseData.comment})||(0,o.jsx)(j.y,{baseColor:"rgba(249, 58, 11, 0.1)",highlightColor:"#212130",children:(0,o.jsx)(j.Z,{width:"100%",height:80})})]}),(0,o.jsx)("button",{className:"btn btn-success",type:"submit",children:"Update"})]})})})})]})}}},function(t){t.O(0,[571,619,669,782,198,27,774,888,179],(function(){return e=3248,t(t.s=e);var e}));var e=t.O();_N_E=e}]);